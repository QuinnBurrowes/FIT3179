<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Australian Health Visualisations</title>
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #fafafa;
    }

    h2 {
      text-align: center;
      margin-bottom: 20px;
    }

    .section {
      max-width: 1200px; 
      margin: 0 auto 80px auto; 
    }

    .map-row, .chart-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 90px; /* increased horizontal space */
    }

    .chart, .map {
      flex: 1;
    }

    .section-text {
      margin: 20px 0 40px;
      line-height: 1.6;
      text-align: center;
    }
  </style>
</head>
<body>

  <!-- Section 1 -->
  <section class="section" id="section1">
    <h2>Causes of Death & Obesity Prevalence by State</h2>
    <div class="map-row">
      <div class="map" id="map_deaths"></div>
      <div class="map" id="map_obesity"></div>
    </div>
    <div class="section-text">
      <p>These maps illustrate mortality patterns and obesity prevalence across Australian states. Legends are now positioned outside the map area for consistent alignment.</p>
    </div>
    <div id="deaths_chart"></div>
  </section>

  <!-- Section 2 -->
  <section class="section" id="section2">
    <h2>Diet and Activity by Age Group</h2>
    <div class="chart-row">
      <div class="chart" id="fruit_veg_heatmap"></div>
      <div class="chart" id="activity_donut"></div>
    </div>
    <div class="section-text">
      <p>Dietary patterns and physical activity levels differ significantly by age group, highlighting how behaviour changes across the lifespan.</p>
    </div>
  </section>

  <!-- Section 3 -->
  <section class="section" id="section3">
    <h2>Psychological Distress and Activity</h2>
    <div class="chart-row">
      <div class="chart" id="scatter_distress"></div>
      <div class="chart" id="distress_age_sex"></div>
    </div>
    <div class="section-text">
      <p>The relationship between physical activity and psychological distress reveals significant age- and sex-based disparities, underlining the importance of maintaining physical health for mental wellbeing.</p>
    </div>
  </section>

  <script type="text/javascript">
    /* ---------- MAPS (Section 1) ---------- */
    const mapDeathsSpec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "title": "Leading Causes of Death (Australia)",
      "width": 520,
      "height": 420,
      "data": {
        "url": "https://raw.githubusercontent.com/QuinnBurrowes/FIT3179/main/deaths_map.json",
        "format": {"type": "topojson", "feature": "states"}
      },
      "mark": "geoshape",
      "encoding": {
        "color": {"field": "Deaths", "type": "quantitative", "title": "Deaths per 100k"},
        "tooltip": [{"field": "state"}, {"field": "Deaths"}]
      },
      "projection": {"type": "mercator"},
      "config": {"legend": {"orient": "left"}}
    };

    const mapObesitySpec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "title": "Obesity Prevalence by State",
      "width": 520,
      "height": 420,
      "data": {
        "url": "https://raw.githubusercontent.com/QuinnBurrowes/FIT3179/main/obesity_map.json",
        "format": {"type": "topojson", "feature": "states"}
      },
      "mark": "geoshape",
      "encoding": {
        "color": {"field": "Obesity", "type": "quantitative", "title": "% Obese"},
        "tooltip": [{"field": "state"}, {"field": "Obesity"}]
      },
      "projection": {"type": "mercator"},
      "config": {"legend": {"orient": "right"}}
    };

    vegaEmbed("#map_deaths", mapDeathsSpec, {actions:false});
    vegaEmbed("#map_obesity", mapObesitySpec, {actions:false});

    /* ---------- SECTION 2 ---------- */
    const fruitVegSpec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "data": {"url": "https://raw.githubusercontent.com/QuinnBurrowes/FIT3179/main/fruit_veg.csv"},
      "mark": "rect",
      "width": 500,
      "height": 400,
      "encoding": {
        "x": {"field": "Age_Group", "type": "ordinal", "sort": "ascending", "title": "Age Group"},
        "y": {"field": "Guideline", "type": "ordinal", "title": "Guideline"},
        "color": {"field": "Percent", "type": "quantitative", "title": "% Meeting Guidelines", "scale": {"scheme": "greens"}},
        "tooltip": [{"field": "Age_Group"}, {"field": "Guideline"}, {"field": "Percent", "title": "%"}]
      },
      "title": "Fruit and Vegetable Consumption by Age Group"
    };

    const activityDonutSpec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "data": {"url": "https://raw.githubusercontent.com/QuinnBurrowes/FIT3179/main/activity_minutes.csv"},
      "mark": {"type": "arc", "innerRadius": 100},
      "encoding": {
        "theta": {"field": "Minutes", "type": "quantitative"},
        "color": {"field": "Age_Group", "type": "nominal"},
        "tooltip": [{"field": "Age_Group"}, {"field": "Minutes"}]
      },
      "title": "Weekly Activity (Minutes) by Age Group"
    };

    vegaEmbed("#fruit_veg_heatmap", fruitVegSpec, {actions:false});
    vegaEmbed("#activity_donut", activityDonutSpec, {actions:false});

    /* ---------- SECTION 3 ---------- */
    const scatterDistressSpec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "width": 520,
      "height": 360,
      "data": {"url":"https://raw.githubusercontent.com/QuinnBurrowes/FIT3179/main/activity_vs_distress.csv"},
      "mark":{"type":"point","filled":true,"size":140},
      "encoding":{
        "x":{"field":"Activity_Met","type":"quantitative","title":"% meeting activity guidelines"},
        "y":{"field":"Distress_High","type":"quantitative","title":"% high/very high distress"},
        "color":{"field":"Age_Group","type":"nominal"},
        "tooltip":[
          {"field":"Age_Group"},
          {"field":"Activity_Met","title":"% Active"},
          {"field":"Distress_High","title":"% High Distress"}
        ]
      },
      "config":{"view":{"stroke":"transparent"}},
      "title": "Relationship Between Activity and Psychological Distress"
    };

    const distressAgeSexSpec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "description": "Stacked bars: Percent distress-level by AgeGroup, by Sex.",
      "data": {
        "url": "https://raw.githubusercontent.com/QuinnBurrowes/FIT3179/refs/heads/main/psychological_distress.csv",
        "format": {"type": "csv"}
      },
      "width": 420,
      "height": 320,
      "title": "Distribution of Distress Level by Age Group — Males vs Females",
      "transform": [
        {"filter": {"field": "Sex", "oneOf": ["Males", "Females"]}},
        {"calculate": "toNumber(datum.Percent)", "as": "PercentNum"},
        {
          "calculate": "datum.DistressLevel == 'Low distress level' ? 1 : datum.DistressLevel == 'Moderate distress level' ? 2 : datum.DistressLevel == 'High distress level' ? 3 : 4",
          "as": "DistressRank"
        }
      ],
      "facet": {
        "column": {
          "field": "Sex",
          "type": "nominal",
          "sort": ["Males", "Females"],
          "header": {"labelAngle": 0, "title": null}
        }
      },
      "spec": {
        "mark": {"type": "bar", "cornerRadiusEnd": 2},
        "encoding": {
          "y": {
            "field": "AgeGroup",
            "type": "ordinal",
            "sort": {
              "domain": [
                "18–24",
                "25–34",
                "35–44",
                "45–54",
                "55–64",
                "65 years and over"
              ]
            },
            "axis": {"title": null}
          },
          "x": {
            "field": "PercentNum",
            "type": "quantitative",
            "stack": "zero",
            "axis": {"title": "Percent (%)"}
          },
          "color": {
            "field": "DistressLevel",
            "type": "nominal",
            "scale": {
              "domain": [
                "Low distress level",
                "Moderate distress level",
                "High distress level",
                "Very high distress level"
              ],
              "range": ["#4daf4a", "#377eb8", "#ff7f00", "#e41a1c"]
            },
            "legend": {"title": "Distress level", "orient": "right"}
          },
          "order": {
            "field": "DistressRank",
            "type": "quantitative",
            "sort": "ascending"
          },
          "tooltip": [
            {"field": "Sex", "type": "nominal"},
            {"field": "AgeGroup", "type": "nominal"},
            {"field": "DistressLevel", "type": "nominal"},
            {"field": "PercentNum", "type": "quantitative", "title": "Percent"}
          ]
        }
      },
      "resolve": {"legend": {"color": "shared"}}
    };

    vegaEmbed("#scatter_distress", scatterDistressSpec, {actions:false});
    vegaEmbed("#distress_age_sex", distressAgeSexSpec, {actions:false});
  </script>
</body>
</html>
